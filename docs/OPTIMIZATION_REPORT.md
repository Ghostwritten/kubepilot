# KubePilot all.yml ä¼˜åŒ–æŠ¥å‘Š

## ğŸ“… ä¼˜åŒ–æ—¶é—´
2025-08-25 13:42

## ğŸ“Š ä¼˜åŒ–ç»Ÿè®¡
- **åŸå§‹æ–‡ä»¶è¡Œæ•°**: 240 è¡Œ
- **ä¼˜åŒ–åè¡Œæ•°**: 214 è¡Œ
- **å‡å°‘è¡Œæ•°**: 26 è¡Œ (10.8% å‡å°‘)

## ğŸ—‘ï¸ å·²ç§»é™¤çš„æœªä½¿ç”¨å˜é‡

### 1. ç‰ˆæœ¬ä¿¡æ¯å˜é‡
```yaml
# ç§»é™¤åŸå› ï¼šæœªè¢«é¡¹ç›®ä¸­çš„ä»»ä½•è§’è‰²æˆ–ä»»åŠ¡ä½¿ç”¨
kubepilot_version: "1.0.0"                    # åªåœ¨downloadè§’è‰²ä¸­è¢«é”™è¯¯å¼•ç”¨
kubepilot_build_date: "{{ ansible_date_time.date }}"  # ä»æœªè¢«ä½¿ç”¨
```

### 2. æœªå®ç°çš„åŠŸèƒ½å¼€å…³
```yaml
# ç§»é™¤åŸå› ï¼šåŠŸèƒ½æœªå®ç°ï¼Œä¿ç•™ä¼šé€ æˆæ··æ·†
enable_ingress_nginx: true      # åŠŸèƒ½æœªå®ç°
enable_cert_manager: false      # åŠŸèƒ½æœªå®ç°
enable_prometheus: false        # åŠŸèƒ½æœªå®ç°
enable_grafana: false           # åŠŸèƒ½æœªå®ç°
backup_enabled: false           # åŠŸèƒ½æœªå®ç°
backup_schedule: "0 2 * * *"    # åŠŸèƒ½æœªå®ç°
backup_retention_days: 7        # åŠŸèƒ½æœªå®ç°
rbac_enabled: true              # åŠŸèƒ½æœªå®ç°
network_policy_enabled: false   # åŠŸèƒ½æœªå®ç°
pod_security_policy_enabled: false  # åŠŸèƒ½æœªå®ç°
```

### 3. æœªä½¿ç”¨çš„ç³»ç»Ÿé…ç½®
```yaml
# ç§»é™¤åŸå› ï¼šæœªæ‰¾åˆ°ä½¿ç”¨ä½ç½®
systemd_dir: /etc/systemd/system      # æœªæ‰¾åˆ°ä½¿ç”¨
system_namespace: kube-system         # æœªæ‰¾åˆ°ä½¿ç”¨
```

### 4. é‡å¤é…ç½®
```yaml
# ç§»é™¤åŸå› ï¼šåœ¨roles/download/defaults/main.ymlä¸­å·²æœ‰å®šä¹‰
alt_arch_mapping:  # é¿å…é‡å¤å®šä¹‰
  amd64: "x86_64"
  arm64: "aarch64"
```

### 5. æ³¨é‡Šæ‰çš„é…ç½®
```yaml
# ç§»é™¤åŸå› ï¼šå·²æ³¨é‡Šï¼Œæ¸…ç†æ— ç”¨ä»£ç 
#yum_repo: "{{ http_server }}/rpms"
#ubuntu_repo: "{{ http_server }}/debs"
#cni_download_url: "{{ files_repo }}/cni-plugins-linux-{{ image_arch }}-{{ cni_version }}.tgz"
```

## âœ… ä¿ç•™çš„é‡è¦å˜é‡

### 1. æ ¸å¿ƒé…ç½®
- `kube_version`, `kube_version_major_minor`, `kube_version_full`
- `containerd_version` åŠç›¸å…³é…ç½®
- `calico_version`
- `offline_mode`, `http_server`

### 2. ç½‘ç»œé…ç½®
- `kube_pod_cidr`, `kube_service_cidr`
- `registry_host`
- `proxy_env`

### 3. ç³»ç»Ÿé…ç½®
- `ntp_servers`
- `node_labels`
- `ansible_python_interpreter`

## ğŸ”§ æ ¼å¼ä¼˜åŒ–

### 1. ç»Ÿä¸€æ—¥å¿—çº§åˆ«æ ¼å¼
```yaml
# ä¿®æ”¹å‰
log_level: "info"  # debug, info, warn, error

# ä¿®æ”¹å
log_level: 2  # ç»Ÿä¸€ä¸ºæ•°å­—æ ¼å¼ï¼Œä¸inventory.iniä¿æŒä¸€è‡´
```

### 2. æ”¹è¿›æ³¨é‡Šç»“æ„
- æ·»åŠ äº†æ¸…æ™°çš„åˆ†åŒºæ³¨é‡Š
- ç»Ÿä¸€äº†æ³¨é‡Šæ ¼å¼
- æ·»åŠ äº†å˜é‡ç”¨é€”è¯´æ˜

### 3. æ¸…ç†æ— ç”¨æ³¨é‡Š
- ç§»é™¤äº†å·²æ³¨é‡Šçš„é…ç½®ä»£ç 
- ç§»é™¤äº†é‡å¤çš„è¯´æ˜æ³¨é‡Š

## ğŸ“ å¤‡ä»½ä¿¡æ¯
- **å¤‡ä»½æ–‡ä»¶**: `all.yml.backup.20250825_134218`
- **å¤‡ä»½ä½ç½®**: `inventory/k8s01/group_vars/`
- **å¤‡ä»½å¤§å°**: ä¸åŸæ–‡ä»¶ç›¸åŒ

## âœ… éªŒè¯ç»“æœ
- **YAMLè¯­æ³•**: âœ… æœ‰æ•ˆ
- **æ–‡ä»¶å¤§å°**: âœ… å‡å°‘10.8%
- **åŠŸèƒ½å®Œæ•´æ€§**: âœ… æ‰€æœ‰è¢«ä½¿ç”¨çš„å˜é‡éƒ½å·²ä¿ç•™

## ğŸ¯ ä¼˜åŒ–æ•ˆæœ

### 1. æé«˜å¯ç»´æŠ¤æ€§
- ç§»é™¤äº†26è¡Œæ— ç”¨ä»£ç 
- å‡å°‘äº†é…ç½®æ··æ·†
- æé«˜äº†æ–‡ä»¶å¯è¯»æ€§

### 2. å‡å°‘é…ç½®é”™è¯¯
- ç§»é™¤äº†æœªå®ç°åŠŸèƒ½çš„å¼€å…³
- ç»Ÿä¸€äº†é…ç½®æ ¼å¼
- é¿å…äº†é‡å¤å®šä¹‰

### 3. æå‡æ€§èƒ½
- å‡å°‘äº†Ansibleå˜é‡åŠ è½½æ—¶é—´
- é™ä½äº†å†…å­˜å ç”¨
- æé«˜äº†é…ç½®è§£ææ•ˆç‡

## ğŸ“ åç»­å»ºè®®

### 1. å®šæœŸæ¸…ç†
- å»ºè®®æ¯å­£åº¦æ£€æŸ¥ä¸€æ¬¡æœªä½¿ç”¨çš„å˜é‡
- åŠæ—¶ç§»é™¤æ–°æ·»åŠ çš„æœªä½¿ç”¨é…ç½®

### 2. åŠŸèƒ½å®ç°
- å¦‚æœéœ€è¦ä½¿ç”¨å·²ç§»é™¤çš„åŠŸèƒ½å¼€å…³ï¼Œè¯·å…ˆå®ç°ç›¸å…³åŠŸèƒ½
- å®ç°åå†é‡æ–°æ·»åŠ ç›¸åº”çš„é…ç½®å˜é‡

### 3. æ–‡æ¡£æ›´æ–°
- æ›´æ–°ç›¸å…³çš„éƒ¨ç½²æ–‡æ¡£
- ç¡®ä¿é…ç½®ç¤ºä¾‹ä¸å®é™…é…ç½®ä¸€è‡´

## ğŸ”„ å›æ»šæ–¹æ³•
å¦‚éœ€å›æ»šåˆ°ä¼˜åŒ–å‰çš„ç‰ˆæœ¬ï¼š
```bash
cp inventory/k8s01/group_vars/all.yml.backup.20250825_134218 inventory/k8s01/group_vars/all.yml
```


